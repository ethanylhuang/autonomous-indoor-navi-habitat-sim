<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autonomous Vehicle Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #e0e0e0;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
            background: #16213e;
            border-bottom: 2px solid #0f3460;
        }

        .header h1 {
            font-size: 18px;
            font-weight: 600;
            color: #e94560;
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-info span {
            font-size: 14px;
            color: #a0a0b0;
        }

        .header-info span strong {
            color: #e0e0e0;
        }

        #resetBtn {
            padding: 6px 16px;
            background: #e94560;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }

        #resetBtn:hover {
            background: #c73e54;
        }

        .camera-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            padding: 8px 24px;
        }

        .panel {
            background: #16213e;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #0f3460;
        }

        .panel-title {
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #a0a0b0;
            background: #0f3460;
        }

        .panel img {
            width: 100%;
            height: auto;
            display: block;
        }

        .bottom-row {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 8px;
            padding: 0 24px 8px;
        }

        .state-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px 16px;
            padding: 12px;
            font-size: 13px;
            font-family: "Courier New", monospace;
        }

        .state-grid .label {
            color: #a0a0b0;
        }

        .state-grid .value {
            color: #e0e0e0;
        }

        .controls {
            padding: 8px 24px 16px;
            text-align: center;
            font-size: 13px;
            color: #606080;
        }

        .controls kbd {
            background: #0f3460;
            padding: 2px 8px;
            border-radius: 3px;
            font-family: monospace;
            color: #e0e0e0;
            margin: 0 2px;
        }

        #connection-status {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 3px;
        }

        .connected {
            background: #1b5e20;
            color: #a5d6a7;
        }

        .disconnected {
            background: #b71c1c;
            color: #ef9a9a;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Autonomous Vehicle Viewer</h1>
        <div class="header-info">
            <select id="sceneSelect" style="padding: 4px 8px; background: #0f3460; color: #e0e0e0; border: 1px solid #1a1a2e; border-radius: 4px; font-size: 13px; cursor: pointer;">
                <option value="">Loading scenes...</option>
            </select>
            <span id="connection-status" class="disconnected">Disconnected</span>
            <span>Step: <strong id="stepCount">0</strong></span>
            <span>Collided: <strong id="collided">No</strong></span>
            <button id="resetBtn">Reset</button>
        </div>
    </div>

    <div class="camera-row">
        <div class="panel">
            <div class="panel-title">Forward RGB — Click to Project</div>
            <div id="fwdContainer" style="position: relative; cursor: crosshair;">
                <img id="fwd" alt="Forward Camera" style="display: block; width: 100%;">
                <div id="fwdClickMarker" style="display: none; position: absolute; width: 16px; height: 16px; border: 2px solid #00ffff; border-radius: 50%; background: rgba(0,255,255,0.3); transform: translate(-50%, -50%); pointer-events: none;"></div>
            </div>
        </div>
        <div class="panel">
            <div class="panel-title">Rear RGB</div>
            <img id="rear" alt="Rear Camera">
        </div>
        <div class="panel">
            <div class="panel-title">Depth (Colorized)</div>
            <img id="depthImg" alt="Depth Map">
        </div>
    </div>

    <!-- M3 Navigation Control + NavMesh (merged) -->
    <div class="bottom-row" style="grid-template-columns: 400px 1fr 1fr;">
        <div class="panel">
            <div class="panel-title">NavMesh — Click to Set Goal</div>
            <div style="position: relative; cursor: crosshair;">
                <img id="topdown" alt="Top-Down View" style="display: block; width: 100%;">
                <div id="goalPin" style="display: none; position: absolute; width: 12px; height: 12px; border: 2px solid #00ff00; border-radius: 50%; background: rgba(0,255,0,0.4); transform: translate(-50%, -50%); pointer-events: none;"></div>
                <div id="projectedPin" style="display: none; position: absolute; width: 14px; height: 14px; border: 2px solid #00ffff; border-radius: 50%; background: rgba(0,255,255,0.4); transform: translate(-50%, -50%); pointer-events: none;"></div>
            </div>
        </div>
        <div class="panel">
            <div class="panel-title">Navigation Control</div>
            <div style="padding: 12px;">
                <div style="display: flex; gap: 8px; margin-bottom: 8px; flex-wrap: wrap;">
                    <button id="startNavBtn" style="padding: 6px 16px; background: #1b5e20; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;">Random Goal</button>
                    <button id="startNavToBtn" style="padding: 6px 16px; background: #0f3460; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;" disabled>Nav to Pin</button>
                    <button id="stopNavBtn" style="padding: 6px 16px; background: #b71c1c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;" disabled>Stop</button>
                </div>
                <div style="font-size: 13px; color: #a0a0b0; margin-bottom: 4px;">Mode: <strong id="navModeValue" style="color: #e0e0e0;">Manual</strong></div>
                <div id="pinnedGoalLabel" style="display: none; font-size: 12px; color: #a0a0b0; margin-bottom: 4px;">Pin: <span id="pinnedGoalCoords" style="color: #00ff88;">--</span></div>
                <div id="projectedLabel" style="display: none; font-size: 12px; color: #a0a0b0; margin-bottom: 4px;">Projected: <span id="projectedCoords" style="color: #00ffff;">--</span></div>
                <div id="navResult" style="display: none; padding: 6px; border-radius: 4px; margin-top: 4px; font-size: 13px;"></div>
            </div>
        </div>
        <div class="panel">
            <div class="panel-title">Navigation Status</div>
            <div class="state-grid">
                <span class="label">Goal:</span>
                <span class="value" id="navGoal">--</span>
                <span class="label">Distance:</span>
                <span class="value" id="navDistance">--</span>
                <span class="label">Heading Err:</span>
                <span class="value" id="navHeading">--</span>
                <span class="label">Nav Steps:</span>
                <span class="value" id="navSteps">--</span>
                <span class="label">Nav Collisions:</span>
                <span class="value" id="navCollisions">--</span>
                <span class="label">Path Length:</span>
                <span class="value" id="navPathLength">--</span>
                <span class="label">SPL:</span>
                <span class="value" id="navSPL">--</span>
                <span class="label">Action:</span>
                <span class="value" id="navAction">--</span>
            </div>
        </div>
    </div>

    <!-- M5 VLM Navigation Control -->
    <div style="padding: 0 24px 8px;">
        <div class="panel">
            <div class="panel-title">VLM Semantic Navigation (M5)</div>
            <div style="padding: 12px;">
                <div style="display: flex; gap: 8px; margin-bottom: 8px; align-items: center;">
                    <input type="text" id="vlmInstructionInput" placeholder="e.g., go to the bedroom" style="flex: 1; padding: 8px 12px; border: 1px solid #0f3460; border-radius: 4px; background: #1a1a2e; color: #e0e0e0; font-size: 14px;">
                    <button id="startVlmNavBtn" style="padding: 8px 20px; background: #6a1b9a; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; white-space: nowrap;">Start VLM Nav</button>
                    <button id="stopVlmNavBtn" style="padding: 8px 16px; background: #b71c1c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;" disabled>Stop</button>
                </div>
                <div id="vlmStatusPanel" style="display: none; background: #0f3460; border-radius: 4px; padding: 8px 12px; margin-top: 8px;">
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 4px 12px; font-size: 13px;">
                        <span style="color: #a0a0b0;">Instruction:</span>
                        <span id="vlmInstruction" style="color: #e0e0e0;">--</span>
                        <span style="color: #a0a0b0;">Subgoal:</span>
                        <span id="vlmSubgoal" style="color: #e94560;">--</span>
                        <span style="color: #a0a0b0;">VLM Reasoning:</span>
                        <span id="vlmReasoning" style="color: #a5d6a7; font-style: italic;">--</span>
                        <span style="color: #a0a0b0;">Confidence:</span>
                        <span id="vlmConfidence" style="color: #e0e0e0;">--</span>
                        <span style="color: #a0a0b0;">Steps / VLM Calls:</span>
                        <span id="vlmStepsCalls" style="color: #e0e0e0;">--</span>
                    </div>
                </div>
                <div id="vlmResult" style="display: none; padding: 6px; border-radius: 4px; margin-top: 8px; font-size: 13px;"></div>
            </div>
        </div>
    </div>

    <!-- Semantic Object Navigation -->
    <div style="padding: 0 24px 8px;">
        <div class="panel">
            <div class="panel-title">Semantic Object Navigation</div>
            <div style="padding: 12px;">
                <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                    <select id="semanticObjectSelect" style="flex: 1; padding: 6px 8px; background: #0f3460; color: #e0e0e0; border: 1px solid #0f3460; border-radius: 4px; font-size: 13px;">
                        <option value="">Select object...</option>
                    </select>
                    <button id="navToObjectBtn" style="padding: 6px 16px; background: #0f3460; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;" disabled>Navigate</button>
                </div>
                <div id="objectDetail" style="display: none; font-size: 12px; color: #a0a0b0; padding: 8px; background: #0f3460; border-radius: 4px;">
                    <div>Label: <span id="objectLabel" style="color: #00ff88;">--</span></div>
                    <div>Position: <span id="objectPos" style="color: #00ff88;">--</span></div>
                </div>
            </div>
        </div>
    </div>

    <div style="padding: 0 24px 8px;">
        <div class="panel">
            <div class="panel-title">Agent State</div>
            <div class="state-grid" style="grid-template-columns: repeat(5, auto auto); gap: 4px 12px;">
                <span class="label">Pos X:</span>
                <span class="value" id="posX">--</span>
                <span class="label">Pos Y:</span>
                <span class="value" id="posY">--</span>
                <span class="label">Pos Z:</span>
                <span class="value" id="posZ">--</span>
                <span class="label">Rot W:</span>
                <span class="value" id="rotW">--</span>
                <span class="label">Rot X:</span>
                <span class="value" id="rotX">--</span>
                <span class="label">Rot Y:</span>
                <span class="value" id="rotY">--</span>
                <span class="label">Rot Z:</span>
                <span class="value" id="rotZ">--</span>
                <span class="label">IMU Accel:</span>
                <span class="value" id="imuAccel">--</span>
                <span class="label">IMU AngVel:</span>
                <span class="value" id="imuAngVel">--</span>
                <span class="label">IMU Step:</span>
                <span class="value" id="imuStep">--</span>
            </div>
        </div>
    </div>

    <!-- M2 Perception Panels -->
    <div class="camera-row">
        <div class="panel">
            <div class="panel-title">Point Cloud BEV</div>
            <img id="pointCloudBev" alt="Point Cloud Bird's-Eye View">
        </div>
        <div class="panel">
            <div class="panel-title">Occupancy Grid</div>
            <img id="occGrid" alt="Occupancy Grid">
        </div>
        <div class="panel">
            <div class="panel-title">Semantic Overlay</div>
            <img id="semanticFwd" alt="Semantic Overlay">
        </div>
    </div>

    <div class="bottom-row">
        <div class="panel">
            <div class="panel-title">VO Trajectory</div>
            <img id="voTrajectory" alt="VO Trajectory">
        </div>
        <div class="panel">
            <div class="panel-title">M2 Perception Stats</div>
            <div class="state-grid">
                <span class="label">VO Inliers:</span>
                <span class="value" id="voInliers">--</span>
                <span class="label">VO Valid:</span>
                <span class="value" id="voValid">--</span>
                <span class="label">Occupied Cells:</span>
                <span class="value" id="occupiedCells">--</span>
                <span class="label">Free Cells:</span>
                <span class="value" id="freeCells">--</span>
                <span class="label">Fwd Obstacle Px:</span>
                <span class="value" id="fwdObstaclePx">--</span>
                <span class="label">Rear Obstacle Px:</span>
                <span class="value" id="rearObstaclePx">--</span>
            </div>
        </div>
    </div>

    <div class="controls">
        Controls:
        <kbd>W</kbd> Forward |
        <kbd>A</kbd> Turn Left |
        <kbd>D</kbd> Turn Right |
        <kbd>R</kbd> Reset
        <span id="controlsDisabledHint" style="display: none; color: #e94560; margin-left: 8px;">(WASD disabled during autonomous nav)</span>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
